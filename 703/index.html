<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fine-tuning CodeLlama-7B for Fortran Code Generation</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/5.3.3/zephyr/bootstrap.min.css"
      integrity="sha512-CWXb9sx63+REyEBV/cte+dE1hSsYpJifb57KkqAXjsN3gZQt6phZt7e5RhgZrUbaNfCdtdpcqDZtuTEB+D3q2Q=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/atom-one-dark.min.css" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/highlightjs-copy/dist/highlightjs-copy.min.css" />
    <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/fortran.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/python.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/cpp.min.js"></script>
    <script src="https://unpkg.com/highlightjs-copy/dist/highlightjs-copy.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
      integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
      crossorigin="anonymous"></script>
  </head>
  <body>
    
<div class="container">
  <div class="row">
    <div class="col d-flex justify-content-between align-items-center">
      <h2>Kth Largest Element in a Stream</h2>
      <div>
        <a href="/fortran-llm/" class="btn btn-outline-primary me-2">
          üè†
        </a>
        <a
          href="/fortran-llm/700/"
          class="btn btn-outline-secondary me-2">
          ‚¨ÖÔ∏è
        </a>
        <a
          href="/fortran-llm/704/"
          class="btn btn-outline-secondary">
          ‚û°Ô∏è
        </a>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col">
      <div class="leetcode-problem-content card">
        <div class="card-body">
          <p>Design a class to find the <code>kth</code> largest element in a stream. Note that it is the <code>kth</code> largest element in the sorted order, not the <code>kth</code> distinct element.</p>
<p>Implement <code>KthLargest</code> class:</p>
<ul>
<li><code>KthLargest(int k, int[] nums)</code> Initializes the object with the integer <code>k</code> and the stream of integers <code>nums</code>.</li>
<li><code>int add(int val)</code> Appends the integer <code>val</code> to the stream and returns the element representing the <code>kth</code> largest element in the stream.</li>
</ul>
<p><strong>Example 1:</strong></p>
<p><strong>Input</strong>
[ "KthLargest ",  "add ",  "add ",  "add ",  "add ",  "add "]
[[3, [4, 5, 8, 2]], [3], [5], [10], [9], [4]]
<strong>Output</strong>
[null, 4, 5, 5, 8, 8]</p>
<p><strong>Explanation</strong>
KthLargest kthLargest = new KthLargest(3, [4, 5, 8, 2]);
kthLargest.add(3);   // return 4
kthLargest.add(5);   // return 5
kthLargest.add(10);  // return 5
kthLargest.add(9);   // return 8
kthLargest.add(4);   // return 8</p>
<p><strong>Constraints:</strong></p>
<ul>
<li><code>1 &lt;= k &lt;= 104</code></li>
<li><code>0 &lt;= nums.length &lt;= 104</code></li>
<li><code>-104 &lt;= nums[i] &lt;= 104</code></li>
<li><code>-104 &lt;= val &lt;= 104</code></li>
<li>At most <code>104</code> calls will be made to <code>add</code>.</li>
<li>It is guaranteed that there will be at least <code>k</code> elements in the array when you search for the <code>kth</code> element.</li>
</ul>
          <hr />
          <span class="fst-italic">
            Note: This problem is from
            <a
              href="https://leetcode.com/problems/kth-largest-element-in-a-stream/description/">LeetCode</a>.
          </span>
        </div>
      </div>
      <style>
        .leetcode-problem-content {
          max-height: 200px;
          overflow-y: auto;
        }
      </style>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <ul class="nav nav-underline mb-2" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
          <button
            class="nav-link active"
            id="our-model-tab"
            data-bs-toggle="tab"
            data-bs-target="#our-model-tab-pane"
            type="button"
            role="tab"
            aria-controls="our-model-tab-pane"
            aria-selected="true">
            ü¶æ Our model
          </button>
        </li>
      </ul>
      <div class="tab-content" id="myTabContent">
        <div
          class="tab-pane fade show active"
          id="our-model-tab-pane"
          role="tabpanel"
          aria-labelledby="our-model-tab"
          tabindex="0">
          <div class="row mb-2">
            <div class="col">
              <div
                class="card border-danger"
                style="border-width: 2px">
                <div class="card-body">
                  <span class="font-emoji">
                    ‚ùå
                  </span>
                  <strong>Compiled</strong>
                </div>
              </div>
            </div>

            <div class="col">
              <div
                class="card border-danger"
                style="border-width: 2px">
                <div class="card-body">
                  <span class="font_emoji">
                    ‚ùå
                  </span>
                  <strong>Executed</strong>
                </div>
              </div>
            </div>

            <div class="col">
              <div
                class="card border-danger"
                style="border-width: 2px">
                <div class="card-body">
                  <span class="font-emoji">
                    ‚ùå
                  </span>
                  <strong>Correct</strong>
                </div>
              </div>
            </div>
          </div>
          <pre><code class="language-fortran model-code">program main
    use :: kth_largest_mod
    implicit none

    type(kth_largest) :: kth_largest
    integer :: i, j, k, n
    integer, allocatable :: nums(:)

    ! Example 1
    print *, 'Example 1:'
    k = 3
    allocate(nums(3))
    nums = [4, 5, 8, 2]
    call kth_largest%init(k, nums)
    do i = 1, size(nums)
        print *, kth_largest%add(nums(i))
    end do
    deallocate(nums)

contains

subroutine test()
    use :: kth_largest_mod
    implicit none

    type(kth_largest) :: kth_largest
    integer :: i, j, k, n
    integer, allocatable :: nums(:)

    ! Example 1
    print *, 'Example 1:'
    k = 3
    allocate(nums(3))
    nums = [4, 5, 8, 2]
    call kth_largest%init(k, nums)
    do i = 1, size(nums)
        print *, kth_largest%add(nums(i))
    end do
    deallocate(nums)
end subroutine test

end program main

module kth_largest_mod
    implicit none

    private
    public :: kth_largest

    type :: kth_largest
        private
        integer :: k
        integer, allocatable :: heap(:)
        integer :: heap_size
        logical :: initialized = .false.
    contains
        procedure :: init => init_kth_largest
        procedure :: add => add_to_kth_largest
    end type kth_largest

    interface kth_largest
        module procedure :: init_kth_largest
    end interface kth_largest

contains

subroutine init_kth_largest(this, k, nums)
    class(kth_largest), intent(out) :: this
    integer, intent(in) :: k
    integer, intent(in) :: nums(:)

    if (allocated(this%heap)) then
        deallocate(this%heap)
    end if

    this%k = k
    this%heap_size = 0
    this%initialized = .true.

    call build_heap(this, nums)
end subroutine init_kth_largest

subroutine build_heap(this, nums)
    class(kth_largest), intent(inout) :: this
    integer, intent(in) :: nums(:)
    integer :: i

    do i = 1, size(nums)
        call add_to_heap(this, nums(i))
    end do
end subroutine build_heap

function parent(i) result(parent_index)
    integer, value :: i
    integer :: parent_index

    parent_index = (i + 1) / 2
end function parent

function left(i) result(left_index)
    integer, value :: i
    integer :: left_index

    left_index = 2 * i
end function left

function right(i) result(right_index)
    integer, value :: i
    integer :: right_index

    right_index = 2 * i + 1
end function right

subroutine swap(this, i, j)
    class(kth_largest), intent(inout) :: this
    integer, value :: i, j

    integer :: temp

    temp = this%heap(i)
    this%heap(i) = this%heap(j)
    this%heap(j) = temp
end subroutine swap

subroutine sift_down(this, i)
    class(kth_largest), intent(inout) :: this
    integer, value :: i

    integer :: largest

    largest = i
    if (left(i) <= this%heap_size .and. &</code></pre>

           
          <div class="alert alert-danger" role="alert">
            <strong>stderr</strong>
            <pre>temp.f95:2:11:

    2 |     use :: kth_largest_mod
      |           1
Fatal Error: Cannot open module file ‚Äòkth_largest_mod.mod‚Äô for reading at (1): No such file or directory
compilation terminated.
</pre>
          </div>
          
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <ul class="nav nav-underline mb-2" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
          <button
            class="nav-link active"
            id="codellama-tab"
            data-bs-toggle="tab"
            data-bs-target="#codellama-tab-pane"
            type="button"
            role="tab"
            aria-controls="codellama-tab-pane"
            aria-selected="true">
            ü¶ô CodeLlama-7B
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button
            class="nav-link"
            id="python-tab"
            data-bs-toggle="tab"
            data-bs-target="#python-tab-pane"
            type="button"
            role="tab"
            aria-controls="python-tab-pane"
            aria-selected="false">
            üêç Python
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button
            class="nav-link"
            id="cpp-tab"
            data-bs-toggle="tab"
            data-bs-target="#cpp-tab-pane"
            type="button"
            role="tab"
            aria-controls="cpp-tab-pane"
            aria-selected="false">
            ü§† C++
          </button>
        </li>
      </ul>
      <div class="tab-content" id="myTabContent">
        <div
          class="tab-pane fade show active"
          id="codellama-tab-pane"
          role="tabpanel"
          aria-labelledby="codellama-tab"
          tabindex="0">
          <div class="row mb-2">
            <div class="col">
              <div
                class="card border-danger"
                style="border-width: 2px">
                <div class="card-body">
                  <span class="font-emoji">
                    ‚ùå
                  </span>
                  <strong>Compiled</strong>
                </div>
              </div>
            </div>

            <div class="col">
              <div
                class="card border-danger"
                style="border-width: 2px">
                <div class="card-body">
                  <span class="font-emoji">
                    ‚ùå
                  </span>
                  <strong>Executed</strong>
                </div>
              </div>
            </div>

            <div class="col">
              <div
                class="card border-danger"
                style="border-width: 2px">
                <div class="card-body">
                  <span class="font-emoji">
                    ‚ùå
                  </span>
                  <strong>Correct</strong>
                </div>
              </div>
            </div>
          </div>
          <pre><code class="language-fortran model-code">module KthLargest
    implicit none

    private
    integer, parameter :: k = 3
    integer, parameter :: n = 4
    integer, parameter :: nums(n) = [4, 5, 8, 2]
    integer, parameter :: vals(n) = [3, 3, 5, 10, 9, 4]
    integer, parameter :: expected(n) = [4, 5, 5, 8, 8]

    type :: KthLargest
        integer :: k
        integer :: max_heap(k)
        integer :: min_heap(k)
        integer :: count = 0
    contains
        procedure, public :: add
    end type KthLargest

contains

    function add(this, val) result(res)
        class(KthLargest), intent(inout) :: this
        integer, intent(in) :: val
        integer :: res

        if (this%count < this%k) then
            this%count = this%count + 1
            this%max_heap(this%count) = val
            this%min_heap(this%count) = val
        else
            if (val > this%max_heap(1)) then
                this%max_heap(1) = val
                call sift_up(this%max_heap, 1)
            else if (val < this%min_heap(1)) then
                this%min_heap(1) = val
                call sift_down(this%min_heap, 1)
            end if
        end if

        res = this%max_heap(1)
    end function add

    recursive subroutine sift_up(arr, i)
        integer, intent(inout) :: arr(:)
        integer, intent(in) :: i

        if (i /= 1) then
            if (arr(i) > arr(i/2)) then
                call swap(arr, i, i/2)
                call sift_up(arr, i/2)
            end if
        end if
    end subroutine sift_up

    recursive subroutine sift_down(arr, i)
        integer, intent(inout) :: arr(:)
        integer, intent(in) :: i

        if (2*i <= size(arr)) then
            if (arr(i) < arr(2*i)) then
                call swap(arr, i, 2*i)
                call sift_down(arr, 2*i)
            else if (2*i+1 <= size(arr) .and. arr(i) < arr(2*i+1)) then
                call swap(arr, i, 2*i+1)
                call sift_down(arr, 2*i+1)
            end if
        end if
    end subroutine sift_down

    subroutine swap(arr, i, j)
        integer, intent(inout) :: arr(:)
        integer, intent(in) :: i, j

        integer :: temp

        temp = arr(i)
        arr(i) = arr(j)
        arr(j) = temp
    end subroutine swap

end module KthLargest

program test_kth_largest
    use KthLargest
    implicit none

    type(KthLargest) :: kth_largest
    integer :: i, res

    do i = 1, size(vals)
        res = kth_largest%add(vals(i))
        write (*,*) res
    end do

end program test_kth_largest
</code></pre>
           
          <div class="alert alert-danger" role="alert">
            <strong>stderr</strong>
            <pre>temp.f95:8:33:

    8 |     integer, parameter :: vals(n) = [3, 3, 5, 10, 9, 4]
      |                                 1
Error: Different shape for array assignment at (1) on dimension 1 (4 and 6)
temp.f95:9:37:

    9 |     integer, parameter :: expected(n) = [4, 5, 5, 8, 8]
      |                                     1
Error: Different shape for array assignment at (1) on dimension 1 (4 and 5)
temp.f95:11:22:

   11 |     type :: KthLargest
      |                      1
Error: MODULE attribute of ‚Äòkthlargest‚Äô conflicts with PROCEDURE attribute at (1)
temp.f95:12:20:

   12 |         integer :: k
      |                    1
Error: Symbol ‚Äòk‚Äô at (1) already has basic type of INTEGER
temp.f95:18:7:

   18 |     end type KthLargest
      |       1
Error: Expecting END MODULE statement at (1)
temp.f95:20:8:

   20 | contains
      |        1
Error: Unexpected CONTAINS statement in CONTAINS section at (1)
temp.f95:23:26:

    1 | module KthLargest
      |                 2         
......
   23 |         class(KthLargest), intent(inout) :: this
      |                          1
Error: Type name ‚Äòkthlargest‚Äô at (1) conflicts with previously declared entity at (2), which has the same name
temp.f95:27:18:

   27 |         if (this%count < this%k) then
      |                  1
Error: Symbol ‚Äòthis‚Äô at (1) has no IMPLICIT type
temp.f95:28:18:

   28 |             this%count = this%count + 1
      |                  1
Error: Symbol ‚Äòthis‚Äô at (1) has no IMPLICIT type
temp.f95:29:18:

   29 |             this%max_heap(this%count) = val
      |                  1
Error: Symbol ‚Äòthis‚Äô at (1) has no IMPLICIT type
temp.f95:30:18:

   30 |             this%min_heap(this%count) = val
      |                  1
Error: Symbol ‚Äòthis‚Äô at (1) has no IMPLICIT type
temp.f95:31:12:

   31 |         else
      |            1
Error: Unexpected ELSE statement at (1)
temp.f95:32:28:

   32 |             if (val > this%max_heap(1)) then
      |                            1
Error: Symbol ‚Äòthis‚Äô at (1) has no IMPLICIT type
temp.f95:33:22:

   33 |                 this%max_heap(1) = val
      |                      1
Error: Symbol ‚Äòthis‚Äô at (1) has no IMPLICIT type
temp.f95:34:35:

   34 |                 call sift_up(this%max_heap, 1)
      |                                   1
Error: Symbol ‚Äòthis‚Äô at (1) has no IMPLICIT type
temp.f95:35:33:

   35 |             else if (val < this%min_heap(1)) then
      |                                 1
Error: Symbol ‚Äòthis‚Äô at (1) has no IMPLICIT type
temp.f95:36:22:

   36 |                 this%min_heap(1) = val
      |                      1
Error: Symbol ‚Äòthis‚Äô at (1) has no IMPLICIT type
temp.f95:37:37:

   37 |                 call sift_down(this%min_heap, 1)
      |                                     1
Error: Symbol ‚Äòthis‚Äô at (1) has no IMPLICIT type
temp.f95:38:15:

   38 |             end if
      |               1
Error: Expecting END FUNCTION statement at (1)
temp.f95:39:11:

   39 |         end if
      |           1
Error: Expecting END FUNCTION statement at (1)
temp.f95:41:20:

   41 |         res = this%max_heap(1)
      |                    1
Error: Symbol ‚Äòthis‚Äô at (1) has no IMPLICIT type
temp.f95:22:21:

   22 |     function add(this, val) result(res)
      |                     1
Error: Symbol ‚Äòthis‚Äô at (1) has no IMPLICIT type
temp.f95:85:9:

   85 |     use KthLargest
      |         1
Fatal Error: Cannot open module file ‚Äòkthlargest.mod‚Äô for reading at (1): No such file or directory
compilation terminated.
</pre>
          </div>
          
        </div>
        <div
          class="tab-pane fade"
          id="python-tab-pane"
          role="tabpanel"
          aria-labelledby="python-tab"
          tabindex="0">
          <alert class="alert alert-info d-flex">
            <strong>üåê Data from online sources</strong>
          </alert>
          <pre><code class="language-python">import heapq

class KthLargest:

    def __init__(self, k: int, nums: List[int]):
        self.k = k
        self.min_heap = nums
        heapq.heapify(self.min_heap)

        while len(self.min_heap) &gt; k:
            heapq.heappop(self.min_heap)

    def add(self, val: int) -&gt; int:
        if len(self.min_heap) &lt; self.k:
            heapq.heappush(self.min_heap, val)
        elif val &gt; self.min_heap[0]:
            heapq.heappushpop(self.min_heap, val)
        return self.min_heap[0]
</code></pre>
<p>We will use a min-heap to solve this problem. We initialize the KthLargest class with an integer <code>k</code> and an array <code>nums</code>. In the constructor, we loop through the <code>nums</code> array and call the <code>add</code> function for every element.</p>
<p>The <code>add</code> function does the following:
1. Pushes the new value into the min-heap.
2. If the size of the min-heap is greater than <code>k</code>, we pop an element from the min-heap (i.e., remove the smallest element).
3. We return the top element of the min-heap which represents the k-th largest element in the stream.</p>
<p>For the JavaScript implementation, we also need to create a separate MinHeap class covering the basic functions (offer, poll, peek, size) to maintain minimum priority queue.</p>
<p>All implementations follow the same algorithm, with small syntax differences between programming languages.</p>
        </div>
        <div
          class="tab-pane fade"
          id="cpp-tab-pane"
          role="tabpanel"
          aria-labelledby="cpp-tab"
          tabindex="0">
          <alert class="alert alert-info d-flex">
            <strong>üåê Data from online sources</strong>
          </alert>
          <pre><code class="language-cpp">#include &lt;queue&gt;
#include &lt;vector&gt;

class KthLargest {
public:
    int k;
    std::priority_queue&lt;int, std::vector&lt;int&gt;, std::greater&lt;int&gt;&gt; minHeap;

    KthLargest(int k, std::vector&lt;int&gt;&amp; nums) {
        this-&gt;k = k;
        for (int num : nums) {
            add(num);
        }
    }

    int add(int val) {
        minHeap.push(val);
        if (minHeap.size() &gt; k) {
            minHeap.pop();
        }
        return minHeap.top();
    }
};
</code></pre>
<p>We will use a min-heap to solve this problem. We initialize the KthLargest class with an integer <code>k</code> and an array <code>nums</code>. In the constructor, we loop through the <code>nums</code> array and call the <code>add</code> function for every element.</p>
<p>The <code>add</code> function does the following:
1. Pushes the new value into the min-heap.
2. If the size of the min-heap is greater than <code>k</code>, we pop an element from the min-heap (i.e., remove the smallest element).
3. We return the top element of the min-heap which represents the k-th largest element in the stream.</p>
<p>For the JavaScript implementation, we also need to create a separate MinHeap class covering the basic functions (offer, poll, peek, size) to maintain minimum priority queue.</p>
<p>All implementations follow the same algorithm, with small syntax differences between programming languages.</p>
        </div>
      </div>
      <style>
        .model-code {
          max-height: 600px;
          overflow-y: auto;
        }

        .font-emoji {
          font-family: emoji;
        }
      </style>
    </div>
  </div>
</div>
<script>
  hljs.addPlugin(new CopyButtonPlugin());
  hljs.highlightAll();
</script>

  </body>
</html>